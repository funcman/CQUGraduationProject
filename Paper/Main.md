# 1 绪论

## 1.1 引言
随着互联网技术的广泛应用，人们生活已经离不开网络。电子商务形式的新兴销售模式，已经对传统销售形式产生巨大冲击。网络销售，极大的方便了人们的生活。

但是，在药品销售领域，网络售药才刚刚开始。这其中有政策的原因，也有人们购买心理的原因。归根结底，药品销售涉及人民的健康，是一个需要谨慎对待的问题。

这里，本人尝试通过技术手段，尝试实现一个药品销售管理系统。通过实现这个系统，总结自身在计算机科学与技术专业的学习成果，并探索网络售药的合理方式。
## 1.2 开发背景及运行环境
### 1.2.1 开发背景
电子商务系统是一种重要的计算机系统，并被广泛实现，用于人们的生活当中。药品销售管理系统，是电子商务系统的一种，但是由于其销售的商品的特殊性，这类系统才刚刚起步。

作为一种被广泛使用的技术，JSP技术能够方便的帮助我们建立高效的网站系统，包括实现药品销售管理系统。
### 1.2.2 运行环境
1 硬件条件

本系统在开发阶段，只需要一般的个人电脑即可。考虑到系统规模不大，本系统将数据库与Web服务程序只需安装于同一服务器。网络环境搭建所需的设备如：网卡，交换机，路由器，此处不一一赘述。另需客户端计算机若干。

2 系统平台

由于本系统所采用的技术是基于Java的，可以做到跨平台运行，所以本系统不限于部署于Windows系统，亦可运行于Unix系统。所使用的Web服务端是Tomcat，通过改造亦可运行于其它支持JSP的服务端，这里不做深入。客户端计算机可以采用主流的浏览器，如：IE、Firefox、Chrome、Safari等。

3 开发工具

在开发阶段，使用的操作系统是Mac OS X，测试用浏览器为Firefox，网页设计软件采用BlueGriffon，数据库维护工具为sqlitebrowsor。代码编辑器为高度插件定制化的Vim，作为一款功能插件众多的老牌文本编辑器，其功能足以达到集成开发环境IDE的水准。

4 运行需求

正常使用时不应出错，若运行时遇到不可恢复的系统错误，也必须保证数据完好无损，对数据的精确性、时间特性、适应性等都有一定要求，要求系统运行时能够保证正确性、可靠性、高效性、完整性、易用性、可维护性、可测试性、复用性、安全保密性、可移植性、互联性。

## 1.3 相关技术及原理介绍
### 1.3.1 关于JSP技术
JSP全称为JavaServer Pages，中文为Java服务页，是由Sun公司倡导，多个公司参与，于1999年推出的一门动态网页技术标准。JSP以Java语言作为脚本语言，可嵌入HTML、XML或者其它格式文档的Web网页。

1 JSP运行原理

JSP代码被JSP编译器编译成Java Servlets，这是一种使用Java技术实现CGI功能的技术，主要功能在于交互式地浏览和修改数据，生成动态Web内容。Java Servlets最终由Java编译器javac编译为字节码，由JVM执行。

2 JSP的编写方式

使用JSP编写Web程序，可以采用成熟的MVC模式（模型-视图-控制器）。以JSP作为视图层，Servlets作为控制器，JavaBeans作为模型。JavaBeans是一种Java类，经过编译后部署于Web服务端（Tomcat），可以使用<jsp:useBean>、<jsp:getProperty>和<jsp:setProperty>标记在JSP中使用。普通的Java类，无论是系统的，还是自定义的，都可以通过<%@ page import %>标记在JSP中引入并使用。非MVC模式，在JSP编程中也是非常常见的，JSP是一门很灵活的技术。

JSP页面是由HTML和JSP代码片组成的，Java代码是嵌在标记符“<%”和“%>”之间的。除了HTML和一些JSP标记符，JSP代码的语法是和Java完全一致的。

3 JSP内置对象

request：客户端向服务端发送的请求，可以在这个对象中获取和检索，该对象封装了用户提交的信息。

response：服务端向客户端做出的回应，封装在这个对象之中，可以调用该对象的方法，达到向客户端发送某种回应的目的。

session：由于HTTP协议的无状态性，与客户端的会话信息必须由服务端记录并维护，会话信息即封装于此对象之中，可以自由地向该对象存取属性。

application：该对象用于存取可共享的属性。

out：该对象是一种输出流，可以通过该对象的方法向客户端发送信息。

### 1.3.2 关于SQLite与SQL语言

SQL全称Structured Query Language（结构化查询语言），是一种使用广泛的数据库查询语言。SQLite是一种使用SQL语言的小型关系型数据库，具有一定的便携性，被多种语言、多种平台所支持，具有很强的应用灵活性。

### 1.3.3 关于Tomcat服务器

Tomcat是一个开源的Java Serlvets容器，它是Apache基金会的Jakarta项目中的一个核心项目，由Apache，Sun和其它一些公司及个人共同开发而成。由于有了Sun的参与和支持，最新的Java Servlets和JSP规范总能在Tomcat中得到实现。

# 2 系统分析
分析过程的重点在于确定系统的功能需求，确定实现系统所动用的资源；研究软件系统结构何状态的变化或演化规律，即研究系统行为的理论何方法；在设计之前能更详细评估软件需求和资源的利用率。
## 2.1 系统具体要求
药品销售管理系统实际上是一个信息发布系统和B2C电子商务系统的集合体。作为电子商务系统，需要提供商品信息的查看、发布、维护和检索，商品订单的下达和处理。作为信息发布系统，涉及到信息的查看、发布、维护和检索。同时，需要一套用户管理系统，贯穿整个系统。用户按级别可分为普通用户和管理员，消费者作为普通用户，可以进行注册新用户，维护用户信息，购买药品等；管理员由普通用户提升而来，可以进入后台进行各项信息的维护。同时，还有新药推荐等商务功能需求。从现有的实际情况出发，经过对药品销售管理系统的一番考察和分析，在对药品销售需求的分析基础上，确立了药品销售管理系统的基本实现功能如图2.1所示：

图2.1 系统基本功能图
### 2.1.1 前台信息展示与购药系统
1 用药知识文章的展示

（1） 新发布文章的浏览，首页显示若干条最新文章。

（2） 用药知识专页的浏览，可以查看全部文章。

（3） 用药知识文章的检索，输入关键字，检索出合适的文章。

2 药品信息的展示

（1） 药品类目多级列表，可以点入某类目，浏览其下药品列表。

（2） 具体某项药物信息的浏览。

（3） 推荐药品到网站页面显著位置

3 购买操作

（1） 对指定药品下达订单，填写送货地址、联系方式等。

（2） 对已经下达订单的处理，修改订单信息，删除订单等。
### 2.1.2 后台管理员信息维护与订单处理系统
1 用药知识文章的管理，发布新的文章，修改、删除已发布的文章。

2 药品类目的管理，添加新的类目，修改、删除已存在的类目。

3 药品信息的管理，添加新的药品，修改、删除已存在的类目。

4 用户订单的查看何处理。

### 2.1.3 用户系统

1 新用户注册，在网站首页的显著位置，可以点击进去注册页。

2 对于已注册的用户，可以在首页顶端填写用户名和密码，进行登录，登录后即可进行药品订单的下达。

3 在管理后台中，可以对普通用户进行权限的提升，设置其为管理员；也可以对已存在的管理员，进行降级操作，降为普通用户。

4 在管理后台中，可以对用户信息进行修改，包括用户名和密码的修改；也可以对已存在的用户予以删除操作。

## 2.2 系统可行性分析
经过初步的调研和分析，该系统用软件工程的方法来构思是可行的。具体设计方面选择Vim作为代码的编写工具，除了运用HTML之外，还嵌套使用JSP标记、Java语言等，数据库部分采用SQLite数据库，采用sqlitebrowser查看数据库内容，前端页面的排版采用BlueGriffon进行编排。在指导老师的帮助下，借鉴相关的类似网站开发经验，该系统是可以实现的。

## 2.3 系统的逻辑模型
### 2.3.1 系统数据流图
数据流图是描绘信息在软件系统中流动和处理情况的图形工具，图形符号以黑盒子形式描绘系统里面的咯咯部件。

作用：对系统的分析手段；描述系统的组成结构。

经过分析，该系统的数据流图如图所示：

图2.2 用户浏览及检索文章信息数据流图

图2.3 用户浏览及检索药品信息数据流图

图2.4 用户下单及管理订单数据流图

图2.5 用户注册、登录及管理数据流图

图2.6 管理员进入后台及后台操作数据流图

### 2.3.2 数据词典

待写

# 3 系统总体设计
## 3.1 系统结构设计
通过对系统的分析，得出系统结构如图3.1所示。

图3.1 药品销售管理系统结构

## 3.2 系统的功能模块设计
### 3.2.1 用户浏览
用户浏览功能为用户提供用药知识文章和药品信息的浏览。

图3.2 用户浏览功能模块图
### 3.2.2 信息检索
检索功能为了方便用户在较短时间里查询到自己感兴趣的信息。

图3.3 信息检索功能模块图
### 3.2.3 药品购买
购买功能为用户提供药品购买和订单的维护。

图3.4 药品购买功能模块图
### 3.3.4 管理员管理
管理功能为管理员提供针对销售网站各项信息的发布与维护，订单的处理的功能。

图3.5 管理员后台管理功能模块图
## 3.3 数据库的搭建
数据只有使用数据库来管理，才能做到高效。数据库的表结构与系统功能业务逻辑密切相关，一旦建立之后，再进行修改调整，是很困难且容易出错的。所以，要从一开始就搭建一套完整且合理的数据库表结构。

SQLite是一种轻量级的小型数据库，sqlitebrowsor是一种十分易用的SQLite数据库管理工具。可以通过sqlitebrowsor来查看已建立的表结构。

目前已建立的表有：user，article，list，drug，order
### 3.3.1 用户表user
user表用来存放并管理用户信息，其中包括：自动生成的id，用户名和密码，用户级别（普通用户和管理员），默认收货地址，默认联系方式等。
### 3.3.2 文章表article
article表用来存放用药知识文章，其中包括：自动生成的id，文章名，作者，日期，栏目名，内容等。
### 3.3.3 药品类目表list
list表用来存放并管理药品多级类目，其中包括：自动生成的id，类目名，父级类目id等。
### 3.3.4 药品表drug
drug表用来存放药品信息，其中包括：自动生成的id，药品名称，类目id，库存量，药品信息等。
### 3.3.5 订单表order
order表用来存放并管理订单信息，其中包括：自动生成的id，下单日期，下单用户id，药品id，购买量，用户具体收货地址，具体联系方式等。
# 4 系统的详细设计及实现
在药品销售管理系统的系统分析何系统总体设计的基础上，利用绪论中相关的JSP网站开发的原理技术，我们就可以开始系统的详细设计。系统的设计完全按照软件工程的原理何开发原则进行，按照动态网站开发的程序完成了以下的药品销售管理系统的详细设计。
## 4.1 Tomcat的配置
在Tomcat的conf目录下，有一个名为server.xml的文件。这个文件用于配置Tomcat的服务，在server.xml中添加有一个服务：

```
  <!-- CQU -->
  <Service name="CQU">
      <Connector port="8888" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" />
      <Engine name="CQU" defaultHost="localhost">
          <Host name="localhost" appBase="CQU" />
      </Engine>
  </Service>
```
在终端命令行中输入：

```
$ cd Project/bin
$ sh catalina.sh run
```
即可启动Tomcat。
## 4.2 SQLite数据表结构的建立
本系统的数据库采用SQLite数据库，SQLite所支持的SQL语言，支持代码化建立数据表。数据表的建立代码，编写于CQU/ROOT/inc/initdb.jsp中：

```
<%@ page import="cn.edu.cqu.W14217100.*" %>

<%
    DataManager dm = new DataManager();
    dm.databaseInitialize();
%>
```
这个jsp文件被包含于各个jsp文件之中：

```
<jsp:include page="/inc/initdb.jsp" />
```

余下待完成
# 5 结束语
基于Java的JSP技术，现在被广泛应用于众多网站，是开发动态网站的主要技术之一。Java的应用之广，其技术深度足以保证JSP技术被不断深化。

本人在此项目的开发设计过程中，完整的经历了一个项目从原理开始，逐步迭代开发的过程，受益匪浅。项目基本完成了一个可用的药品销售系统，能够满足药店在网络上销售和推广的需求。这其中得益于本专业的知识体系和JSP技术的方便高效。但是由于条件有限，导致系统或多或少存在缺点：

系统架构过于简单，不利于多人的分工开发。应该采用比较成熟的MVC模式来清晰系统架构，使页面设计、业务逻辑等分而治之，专业分工地进行开发，会开发过程更为高效。

# 参考文献
1. 耿祥义，《JSP基础教程》，清华大学出版社，2004.11；
2. Jason Brittain/Ian F.Darwin，《Tomcat权威指南（第2版）》，2009.9；
3. Grant Allen/Mike Owens，《SQLite权威指南（第2版）》，2012.1
4. Elisabeth Robson/Eric Freeman，《Head First HTML与CSS（第2版）》,2013.9